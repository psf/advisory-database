name: "Import"

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

jobs:
  import:
    name: "Auto import"
    runs-on: "ubuntu-latest"
    continue-on-error: false
    steps:
      - uses: "actions/checkout@v3"
      - uses: "actions/setup-python@v4"
        with:
          python-version: "3.x"
      - run: |
          python -m pip install -r tools/requirements.txt
          python tools/import-data.py

          git config user.name github-actions
          git config user.email github-actions@github.com
          git add historical-advisories
          git diff --cached
      - run: git diff --cached --quiet || git commit -m 'Auto import'
      - run: git push
